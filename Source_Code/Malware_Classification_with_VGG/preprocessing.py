import tensorflow
import os
import numpy as np


base_dir = 'Data'
mal_img_dir = '../Data/basicblock/malware_resized_img'


def is_png(input_file):
    ext = os.path.splitext(os.path.basename(input_file))[1]
    print('ext = ', ext)
    result = False
    if '.png' == ext:
        result = True
    return result


def preprocess_img(img_path, target_size=32):
    from keras.preprocessing import image

    img = image.load_img(img_path, target_size=(target_size, target_size))
    img_tensor = image.img_to_array(img)

    img_tensor = np.expand_dims(img_tensor, axis=0)

    img_tensor /= 255.

    return img_tensor


def gather_img(input_dir, data_set_name):
    img_set = []

    if data_set_name == 'malware':
        img_set.append(0)
    elif data_set_name == 'benign':
        img_set.append(1)

    if not os.path.isdir(input_dir):
        print(input_dir, 'Input directory not found. Exiting.')
        exit(0)

    count = 0

    png_list = os.listdir(input_dir)

    print(png_list)

    for filename in png_list:
        print("filename : ", filename)

        img_path = os.path.join(input_dir, filename)

        img_tensor = preprocess_img(img_path, target_size=32)

        img_set.append(img_tensor)